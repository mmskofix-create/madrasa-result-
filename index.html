<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasa Result</title>

    <style>
        body { font-family: Arial, sans-serif; background:#f0f4ff; padding:20px; }
        .box { background:white; padding:25px; max-width:450px; margin:auto; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
        h2 { text-align:center; color:#003c8f; margin-bottom:20px; }
        input, button {
            width:100%; padding:12px; margin-top:10px;
            border-radius:6px; border:1px solid #ccc; font-size:16px;
        }
        button { background:#0066ff; color:white; border:none; font-size:18px; cursor:pointer; }
        button:hover { background:#004ccc; }
        table { width:100%; border-collapse:collapse; margin-top:15px; }
        th,td { border:1px solid #ddd; padding:8px; font-size:14px; }
        th { background:#003c8f; color:white; }
        .error { color:red; text-align:center; margin-top:15px; font-weight:bold; }
    </style>
</head>
<body>

<div class="box">
    <h2>EXAM RESULT</h2>

    <label>Registration Number</label>
    <input type="text" id="reg">

    <label>Class</label>
    <input type="text" id="cls">

    <button onclick="findResult()">View Result</button>

    <div id="output"></div>
</div>

<script>

const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSQ3XJV-qjySQ0gAFjoE3v1fqq1fx5GjrKwt3CqDYK-Yo5Gj18nBm2j4x4DpclJFM13_0rpi0_46/pub?output=json";

let results = [];

// ----------- Load Google Sheet JSON -------------
async function loadData() {
    const res = await fetch(DATA_URL);
    const raw = await res.text();
    const json = JSON.parse(raw.substring(raw.indexOf("{"), raw.lastIndexOf("}") + 1));

    results = json.feed.entry.map(r => ({
        reg: r.gsx$registrationnumber?.$t || "",
        class: r.gsx$class?.$t || "",
        name: r.gsx$name?.$t || "",
        subjects: [
            { name:"Subject 1 (الْقُرْآن)",       mark:r.gsx$subject1القرآن?.$t || "0" },
            { name:"Subject 2 (حِفْظ)",          mark:r.gsx$subject2حفظ?.$t || "0" },
            { name:"Subject 3 (فِقْه)",          mark:r.gsx$subject3فقه?.$t || "0" },
            { name:"Subject 4 (تَارِيخ)",        mark:r.gsx$subject4تاريخ?.$t || "0" },
            { name:"Subject 5 (أَخْلاق)",        mark:r.gsx$subject5أخلاق?.$t || "0" },
            { name:"Subject 6 (تَجْوِيد)",       mark:r.gsx$subject6تجويد?.$t || "0" },
            { name:"Subject 7 (لِسَانُ الْقُرْآن)", mark:r.gsx$subject7لسانالقرآن?.$t || "0" },
            { name:"Subject 8 (عَقِيدَة)",       mark:r.gsx$subject8عقيدة?.$t || "0" },
            { name:"Subject 9 (تَفْسِير)",       mark:r.gsx$subject9تفسير?.$t || "0" },
            { name:"Subject 10 (دُرُوسُ الْإِحْسَان)", mark:r.gsx$subject10دروسالإحسان?.$t || "0" }
        ],
        total: r.gsx$total?.$t || "0"
    }));
}

loadData();

// ---------------- FIND RESULT ----------------
function findResult() {
    let reg = document.getElementById("reg").value.trim();
    let cls = document.getElementById("cls").value.trim();
    let out = document.getElementById("output");

    if (!reg || !cls) {
        out.innerHTML = `<p class="error">Enter Registration & Class</p>`;
        return;
    }

    const r = results.find(x => x.reg.toUpperCase() === reg.toUpperCase() && x.class === cls);

    if (!r) {
        out.innerHTML = `<p class="error">Result Not Found</p>`;
        return;
    }

    let table = `
        <h3>Name: ${r.name}</h3>
        <h4>Reg: ${r.reg} | Class: ${r.class}</h4>

        <table>
            <tr><th>Subject</th><th>Mark</th></tr>
            ${r.subjects.map(s => `
            <tr><td>${s.name}</td><td>${s.mark}</td></tr>
            `).join("")}
            <tr style="background:#e6f0ff;">
                <td><b>Total</b></td>
                <td><b>${r.total}</b></td>
            </tr>
        </table>
    `;

    out.innerHTML = table;
}

</script>
</body>
</html>
