<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasa Result Search</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Manshaul Uloom Theme Variables */
        :root{
          --navy: #0b3d91;
          --accent: #0f5bd1;
          --muted: #5a6476;
          --white: #ffffff;
          --surface: #fbfdff;
          --shadow: 0 6px 20px rgba(11,61,145,0.1);
          --radius: 12px;
          font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        }

        /* General Styles */
        body {
            font-family: 'Inter', Arial, sans-serif;
            background-color: var(--surface); 
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center; 
            min-height: 100vh;
        }
        .main-container {
            background: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow); 
            width: 100%;
            max-width: 450px;
            margin-bottom: 20px;
        }
        
        .logo-container {
            text-align: center; 
            margin-bottom: 25px; 
        }
        .madrasa-logo {
            width: 100px; 
            height: 100px;
            object-fit: contain;
            border-radius: 50%; 
        }

        h2 {
            text-align: center;
            color: var(--navy); 
            padding-bottom: 15px;
            margin-top: 0;
            font-weight: 800;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--navy); 
            text-align: center; 
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            outline: none; 
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            border-color: var(--accent);
        }
        button {
            width: 100%;
            background-color: var(--accent); 
            color: white;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: var(--navy); 
        }

        #result-display {
            margin-top: 25px;
            padding: 20px;
            border: 1px solid rgba(11,61,145,0.2); 
            border-radius: 8px;
            background-color: var(--surface); 
            text-align: left;
        }
        .result-info-header {
            color: var(--accent); 
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .result-table th, .result-table td {
            border: 1px solid #e0e0e0;
            padding: 10px;
            text-align: left;
        }
        .result-table th {
            background-color: var(--navy); 
            color: white;
            font-weight: 600;
        }
        .total-row td {
            background-color: #eef6ff; 
            font-weight: bold;
            color: var(--navy);
        }
        .grade-row td {
            background-color: #d4edda;
            color: #155724;
            font-size: 1.1em;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="logo-container">
            <img src="m.png" alt="Madrasa Logo" class="madrasa-logo">
        </div>
        
        <h2>EXAM RESULT</h2>

        <form id="result-form">
            <label for="reg_no">Reg.No:</label>
            <input type="text" id="reg_no" name="reg_no" required placeholder="Ex: MUMEH448209">
            
            <label for="class_name">Class</label>
            <input type="text" id="class_name" name="class_name" required placeholder="Ex: 6">

            <button type="submit">View Result</button>
        </form>
        
        <div id="result-display">
            <p style="text-align:center; color:var(--muted);">Enter Registration Number and Class to view result.</p>
        </div>
    </div>

    <script>
        /* --- YOUR UPDATED WORKING GOOGLE SHEET JSON URL --- */
        const DATA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTJu-EDpFYXABL3Be-S-9QTqkWici-5xo9Pc9yS4BDlqulZW45ZK7WKLnWeYeWRk9bNrTD72hsLiOYF/pub?output=tsv';

        let allResults = [];

        const SUBJECT_NAMES = [
            "Quran","Hifz","Fiqh","Thareeq","Aqlakh",
            "Thajveed","Lisan","Aqeedha","Thafseer","Duroos"
        ];

        async function loadData() {
            try {
                document.getElementById("result-display").innerHTML =
                    '<p style="text-align:center;color:var(--accent);"><i class="fas fa-spinner fa-spin"></i> Loading...</p>';

                const res = await fetch(DATA_URL);
                const text = await res.text();

                const rows = text.trim().split("\n").map(r => r.split("\t"));

                const header = rows[0];
                const dataRows = rows.slice(1);

                allResults = dataRows.map(r => {
                    let subjects = [];
                    for (let i = 3; i < 13; i++) {
                        subjects.push({
                            name: SUBJECT_NAMES[i - 3],
                            mark: r[i] || "-"
                        });
                    }

                    return {
                        reg_no: r[0],
                        class: r[1],
                        name: r[2],
                        subjects: subjects,
                        total: r[13],
                        grade: r[15]
                    };
                });

                document.getElementById("result-display").innerHTML =
                    '<p style="text-align:center; color:var(--muted);">Enter Registration Number and Class to view result.</p>';

            } catch (err) {
                document.getElementById("result-display").innerHTML =
                    '<p class="error">Error loading data!</p>';
            }
        }

        loadData();

        document.getElementById('result-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const reg = document.getElementById('reg_no').value.trim().toUpperCase();
            const cls = document.getElementById('class_name').value.trim();

            const result = allResults.find(r => r.reg_no.toUpperCase() === reg && r.class === cls);

            if (!result) {
                document.getElementById('result-display').innerHTML =
                    '<p class="error">No result found!</p>';
                return;
            }

            let tableRows = result.subjects.map(sub => `
                <tr>
                    <td>${sub.name}</td>
                    <td>${sub.mark}</td>
                </tr>`
            ).join("");

            document.getElementById('result-display').innerHTML = `
                <span class="result-info-header">Result Details:</span>
                <p><strong>Name:</strong> ${result.name}</p>
                <p><strong>Registration No:</strong> ${result.reg_no}</p>
                <p><strong>Class:</strong> ${result.class}</p>

                <table class="result-table">
                    <tr>
                        <th>Subject</th>
                        <th>Mark</th>
                    </tr>
                    ${tableRows}
                    <tr class="total-row">
                        <td style="text-align:right;"><strong>Total:</strong></td>
                        <td><strong>${result.total}</strong></td>
                    </tr>
                    <tr class="grade-row">
                        <td style="text-align:right;"><strong>Grade:</strong></td>
                        <td><strong>${result.grade}</strong></td>
                    </tr>
                </table>
            `;
        });
    </script>

</body>
</html>
